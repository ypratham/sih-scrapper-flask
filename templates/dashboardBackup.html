<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Statement Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.0/dist/chartjs-adapter-moment.min.js"></script>
</head>

<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">SIH 2024 Analytics</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Total Submissions</h2>
                <p class="text-3xl font-bold text-blue-600">{{ total_submissions }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Average Software Submissions</h2>
                <p class="text-3xl font-bold text-green-600">{{ software_average }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Average Hardware Submissions</h2>
                <p class="text-3xl font-bold text-yellow-600">{{ hardware_average }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Total Problem Statements</h2>
                <p class="text-3xl font-bold text-purple-600">{{ problem_statement_count }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Software Max Submissions</h2>
                <p class="text-3xl font-bold text-red-600">{{ software_max }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Hardware Max Submissions</h2>
                <p class="text-3xl font-bold text-indigo-600">{{ hardware_max }}</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold mb-4">Search Problem Statement</h2>
            <div class="flex items-center">
                <input type="text" id="psSearch" placeholder="Enter PS number"
                    class="border rounded-l px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="searchPS()"
                    class="bg-blue-500 text-white px-4 py-2 rounded-r hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Search</button>
            </div>
            <div id="searchResult" class="mt-4 hidden">
                <h3 class="font-semibold">Search Result:</h3>
                <p id="psNumber" class="mt-2"></p>
                <p id="psCount" class="mt-1"></p>
                <p id="psRank" class="mt-1"></p>
                <p id="psPercentile" class="mt-1"></p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Submission Distribution</h2>
                <canvas id="distributionChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Top 10 Problem Statements</h2>
                <canvas id="top10Chart"></canvas>
            </div>
        </div>

        <div class="flex bg-white shadow items-center justify-center gap-8 mb-8">
            <div class="  p-6  rounded-lg h-[40vh] ">
                <h2 class="text-xl font-semibold mb-4">Submission Categories</h2>
                <canvas id="categoryPieChart"></canvas>
            </div>

        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Hardware Problem Statements</h2>
                <canvas id="hardwareBarChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Software Problem Statements</h2>
                <canvas id="softwareBarChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const psData = {{ ps_data | tojson }};
        const hardwareData = Object.entries(psData.Hardware).sort((a, b) => b[1] - a[1]).slice(0, 10);
        const softwareData = Object.entries(psData.Software).sort((a, b) => b[1] - a[1]).slice(0, 10);
        console.log(softwareData);
        // Search Functionality (same as before)
        function searchPS() {
            const searchInput = document.getElementById('psSearch').value.trim().toUpperCase();
            const searchResult = document.getElementById('searchResult');
            const psNumber = document.getElementById('psNumber');
            const psCount = document.getElementById('psCount');
            const psRank = document.getElementById('psRank');
            const psPercentile = document.getElementById('psPercentile');

            let found = false;
            let category = '';
            let count = 0;

            // Search in both "Hardware" and "Software" categories
            for (const psCategory in psData) {
                if (psData[psCategory].hasOwnProperty(searchInput)) {
                    count = psData[psCategory][searchInput];
                    category = psCategory;
                    found = true;
                    break;
                }
            }

            if (found) {
                // Flatten the counts across both categories to rank correctly
                let allCounts = [];
                for (const category in psData) {
                    allCounts = allCounts.concat(Object.values(psData[category]));
                }
                allCounts.sort((a, b) => b - a);

                const rank = allCounts.indexOf(count) + 1;
                const percentile = ((allCounts.length - rank) / allCounts.length * 100).toFixed(2);

                searchResult.classList.remove('hidden');
                psNumber.textContent = `Problem Statement: ${searchInput} (${category})`;
                psCount.textContent = `Submissions: ${count}`;
                psRank.textContent = `Rank: ${rank} out of ${allCounts.length}`;
                psPercentile.textContent = `Percentile: ${percentile}%`;
            } else {
                searchResult.classList.remove('hidden');
                psNumber.textContent = `Problem Statement ${searchInput} not found.`;
                psCount.textContent = '';
                psRank.textContent = '';
                psPercentile.textContent = '';
            }
        }


        // Distribution Chart
        new Chart(document.getElementById('distributionChart'), {
            type: 'bar',
            data: {
                labels: ['0-9', '10-49', '50-99', '100-499', '500+'],
                datasets: [{
                    label: 'Number of Problem Statements',
                    data: {{ distribution }},
            backgroundColor: 'rgba(75, 192, 192, 0.6)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
            },
            options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Problem Statements'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Submission Range'
                    }
                }
            }
        }
        });

        // Flatten the psData structure into a single array of [psNumber, ideasCount]
        const flattenedData = Object.entries(psData).flatMap(([category, psEntries]) =>
            Object.entries(psEntries).map(([psNumber, ideasCount]) => [psNumber, ideasCount])
        );

        // Sort the flattened data by ideasCount (descending) and take the top 10
        const sortedData = flattenedData.sort((a, b) => b[1] - a[1]).slice(0, 10);

        // Create the chart
        new Chart(document.getElementById('top10Chart'), {
            type: 'bar',
            data: {
                labels: sortedData.map(item => item[0]), // PS numbers
                datasets: [{
                    label: 'Submissions',
                    data: sortedData.map(item => item[1]), // Submissions count
                    backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Submissions'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Problem Statement Number'
                        }
                    }
                }
            }
        });


        // Category Pie Chart
        const categories = ['Hardware', 'Software'];
        const categoryData = [Object.keys(psData.Hardware).length, Object.keys(psData.Software).length];
        new Chart(document.getElementById('categoryPieChart'), {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    data: categoryData,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Problem Statement Categories'
                    }
                }
            }
        });


        // Hardware Bar Chart
        new Chart(document.getElementById('hardwareBarChart'), {
            type: 'bar',
            data: {
                labels: hardwareData.map(item => item[0]),
                datasets: [{
                    label: 'Submissions',
                    data: hardwareData.map(item => item[1]),
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Submissions'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Problem Statement Number'
                        }
                    }
                }
            }
        });

        // Software Bar Chart
        new Chart(document.getElementById('softwareBarChart'), {
            type: 'bar',
            data: {
                labels: softwareData.map(item => item[0]),
                datasets: [{
                    label: 'Submissions',
                    data: softwareData.map(item => item[1]),
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Submissions'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Problem Statement Number'
                        }
                    }
                }
            }
        });

        document.getElementById('psSearch').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                searchPS();
            }
        });
    </script>
</body>

</html>