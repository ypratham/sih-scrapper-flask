<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Statement Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.0/dist/chartjs-adapter-moment.min.js"></script>
</head>

<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">Problem Statement Dashboard</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Total Submissions</h2>
                <p class="text-3xl font-bold text-blue-600">{{ total_submissions }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Average Submissions</h2>
                <p class="text-3xl font-bold text-green-600">{{ average_submissions }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Total Problem Statements</h2>
                <p class="text-3xl font-bold text-purple-600">{{ problem_statement_count }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Median Submissions</h2>
                <p class="text-3xl font-bold text-yellow-600">{{ median_submissions }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Max Submissions</h2>
                <p class="text-3xl font-bold text-red-600">{{ max_submissions }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Min Submissions</h2>
                <p class="text-3xl font-bold text-indigo-600">{{ min_submissions }}</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold mb-4">Search Problem Statement</h2>
            <div class="flex items-center">
                <input type="text" id="psSearch" placeholder="Enter PS number"
                    class="border rounded-l px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="searchPS()"
                    class="bg-blue-500 text-white px-4 py-2 rounded-r hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Search</button>
            </div>
            <div id="searchResult" class="mt-4 hidden">
                <h3 class="font-semibold">Search Result:</h3>
                <p id="psNumber" class="mt-2"></p>
                <p id="psCount" class="mt-1"></p>
                <p id="psRank" class="mt-1"></p>
                <p id="psPercentile" class="mt-1"></p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Submission Distribution</h2>
                <canvas id="distributionChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Top 10 Problem Statements</h2>
                <canvas id="top10Chart"></canvas>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Submission Categories</h2>
                <canvas id="categoryPieChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Submission Trend</h2>
                <canvas id="trendLineChart"></canvas>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Latest Problem Statements</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="px-4 py-2">PS Number</th>
                            <th class="px-4 py-2">Submissions</th>
                        </tr>
                    </thead>
                    <tbody id="latestPSTable">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const psData = {{ ps_data | tojson }};

        function searchPS() {
            const searchInput = document.getElementById('psSearch').value.trim().toUpperCase();
            const searchResult = document.getElementById('searchResult');
            const psNumber = document.getElementById('psNumber');
            const psCount = document.getElementById('psCount');
            const psRank = document.getElementById('psRank');
            const psPercentile = document.getElementById('psPercentile');

            if (psData.hasOwnProperty(searchInput)) {
                const count = psData[searchInput];
                const sortedCounts = Object.values(psData).sort((a, b) => b - a);
                const rank = sortedCounts.indexOf(count) + 1;
                const percentile = ((Object.keys(psData).length - rank) / Object.keys(psData).length * 100).toFixed(2);

                searchResult.classList.remove('hidden');
                psNumber.textContent = `Problem Statement: ${searchInput}`;
                psCount.textContent = `Submissions: ${count}`;
                psRank.textContent = `Rank: ${rank} out of ${Object.keys(psData).length}`;
                psPercentile.textContent = `Percentile: ${percentile}%`;
            } else {
                searchResult.classList.remove('hidden');
                psNumber.textContent = `Problem Statement ${searchInput} not found.`;
                psCount.textContent = '';
                psRank.textContent = '';
                psPercentile.textContent = '';
            }
        }

        // Distribution Chart
        new Chart(document.getElementById('distributionChart'), {
            type: 'bar',
            data: {
                labels: ['0-9', '10-49', '50-99', '100-499', '500+'],
                datasets: [{
                    label: 'Number of Problem Statements',
                    data: {{ distribution }},
            backgroundColor: 'rgba(75, 192, 192, 0.6)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
            },
            options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Problem Statements'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Submission Range'
                    }
                }
            }
        }
        });

        // Top 10 Chart
        const sortedData = Object.entries(psData).sort((a, b) => b[1] - a[1]).slice(0, 10);
        new Chart(document.getElementById('top10Chart'), {
            type: 'bar',
            data: {
                labels: sortedData.map(item => item[0]),
                datasets: [{
                    label: 'Submissions',
                    data: sortedData.map(item => item[1]),
                    backgroundColor: 'rgba(153, 102, 255, 0.6)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Submissions'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Problem Statement Number'
                        }
                    }
                }
            }
        });

        // Category Pie Chart (simulated data)
        const categories = ['Software', 'Hardware', 'AI/ML', 'IoT', 'Blockchain', 'Other'];
        const categoryData = categories.map(() => Math.floor(Math.random() * 100) + 1);
        new Chart(document.getElementById('categoryPieChart'), {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    data: categoryData,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 206, 86, 0.8)',
                        'rgba(75, 192, 192, 0.8)',
                        'rgba(153, 102, 255, 0.8)',
                        'rgba(255, 159, 64, 0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Problem Statement Categories'
                    }
                }
            }
        });

        // Trend Line Chart (simulated data)
        const trendData = Array.from({ length: 30 }, (_, i) => ({
            x: moment().subtract(29 - i, 'days').format('YYYY-MM-DD'),
            y: Math.floor(Math.random() * 100) + 1
        }));

        new Chart(document.getElementById('trendLineChart'), {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Daily Submissions',
                    data: trendData,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day'
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Number of Submissions'
                        }
                    }
                }
            }
        });

        // Populate Latest PS Table
        const latestPSTable = document.getElementById('latestPSTable');
        Object.entries(psData).slice(-10).forEach(([ps, count]) => {
            const row = latestPSTable.insertRow();
            const cellPS = row.insertCell(0);
            const cellCount = row.insertCell(1);
            cellPS.textContent = ps;
            cellCount.textContent = count;
        });

        // Add event listener for Enter key
        document.getElementById('psSearch').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                searchPS();
            }
        });
    </script>
</body>

</html>